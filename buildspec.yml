version: 0.2

env:
  variables:
    JAVA_HOME: "/usr/lib/jvm/java-8-openjdk-amd64"

phases:
  install:
    commands:
      - "echo INSTALL PHASE START: `date`"
      - apt-get update -y
      - apt-get install -y wget apt-transport-https software-properties-common
      - wget -q "https://packages.microsoft.com/config/ubuntu/$(lsb_release -rs)/packages-microsoft-prod.deb"
      - sudo dpkg -i packages-microsoft-prod.deb
      - rm packages-microsoft-prod.deb
      - sudo apt-get update
      - sudo apt-get install -y powershell
      - pwsh -Command "Install-Module -Name PSScriptAnalyzer -Force"
      - pwsh -Command "Invoke-ScriptAnalyzer -Path . -Settings PSGallery -Recurse -Verbose"
      - pwsh -Command "Install-Module -Name ModuleBuilder -Force -Verbose"
      - pwsh -Command "./Build.ps1"
    finally:
      - echo This always runs even if the update or install command fails 

  pre_build:
    commands:
      - echo Entered the pre_build phase...
    finally:
      - echo This always runs even if the login command fails

  build:
    commands:
      - echo Entered the build phase...
      - echo Build started on `date`
    finally:
      - echo This always runs even if the install command fails

  post_build:
    commands:
      - echo Entered the post_build phase...
      - echo $CODEBUILD_SRC_DIR

artifacts:
  files:
    - Output/Splitwise/*
  name: Splitwise
